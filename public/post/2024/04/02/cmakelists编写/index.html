<!DOCTYPE html>
<html lang="en-us" style="font-size: 120%">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="author" content="落">

  
  
  <meta name="description" content="CMakeLists编写基础语法">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="/Blog_Hugo/logo180x180.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/Blog_Hugo/logo32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/Blog_Hugo/logo16x16.ico">

  
  
  <meta name="keywords" content="hugo latex theme blog texify texify2 weastur">
  

  
  
  <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css">
<script defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script>

<script defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"
  onload="renderMathInElement(document.body);"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false }
      ]
    });
  });
</script>

  

  
  <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="weastur" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FF5F5F" data-position="Right" data-x_margin="18" data-y_margin="18"></script>


  
  <meta property="og:url" content="https://seashore.top/Blog_Hugo/post/2024/04/02/cmakelists%E7%BC%96%E5%86%99/">
  <meta property="og:site_name" content="Luo&#39;s Blog">
  <meta property="og:title" content="CMakeLists编写">
  <meta property="og:description" content="CMakeLists编写基础语法">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-04-02T21:31:09+00:00">
    <meta property="article:modified_time" content="2024-04-02T21:31:09+00:00">
    <meta property="article:tag" content="Cmake">
    <meta property="article:tag" content="C">
    <meta property="article:tag" content="Cpp">
    <meta property="og:image" content="https://seashore.top/Blog_Hugo/images/logo3.png">


  
  <link rel="canonical" href="https://seashore.top/Blog_Hugo/post/2024/04/02/cmakelists%E7%BC%96%E5%86%99/">

  
  
  
  <meta itemprop="name" content="CMakeLists编写">
  <meta itemprop="description" content="CMakeLists编写基础语法">
  <meta itemprop="datePublished" content="2024-04-02T21:31:09+00:00">
  <meta itemprop="dateModified" content="2024-04-02T21:31:09+00:00">
  <meta itemprop="wordCount" content="8123">
  <meta itemprop="image" content="https://seashore.top/Blog_Hugo/images/logo3.png">
  <meta itemprop="keywords" content="Cmake,C,Cpp">

  
  <link media="screen" rel="stylesheet" href='https://seashore.top/Blog_Hugo/css/common.css'>
  <link media="screen" rel="stylesheet" href='https://seashore.top/Blog_Hugo/css/content.css'>

  
  
  <title>CMakeLists编写 - Luo&#39;s Blog</title>
  

  
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://seashore.top/Blog_Hugo/images/logo3.png">
  <meta name="twitter:title" content="CMakeLists编写">
  <meta name="twitter:description" content="CMakeLists编写基础语法">


  
<link rel="stylesheet" href='https://seashore.top/Blog_Hugo/css/single.css'>
<link rel="stylesheet" href='https://seashore.top/Blog_Hugo/css/sharingbuttons.css'>

</head>

<body>
  <div id="wrapper">
    


<header id="header">
  <h1>
    <a href="https://seashore.top/Blog_Hugo/"></a>
  </h1>

  <nav>
    
    <span class="nav-bar-item">
      <a class="link" href="../">Guid</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="link" href="/Blog_Hugo/">Home</a>
    </span>
    
    <span class="nav-bar-item">
      <a class="link" href="/Blog_Hugo/post/">Posts</a>
    </span>
    
  </nav>
  
  <div id="searchbox">
    <form method="get" id="search" target="_blank" action="https://duckduckgo.com/">
      <input type="hidden" name="sites" value="seashore.top">
      <input type="text" name="q" placeholder="Search...">
    </form>
  </div>
  
</header>

    
<main id="main" class="post">
  
  <h1>CMakeLists编写</h1>
  
  <div>
    
    <a class="link" href='https://seashore.top/Blog_Hugo/tags/cmake'>#cmake</a>
    
    <a class="link" href='https://seashore.top/Blog_Hugo/tags/c'>#C</a>
    
    <a class="link" href='https://seashore.top/Blog_Hugo/tags/cpp'>#Cpp</a>
    
  </div>
  
  
  
  <details>
    <summary>
      <b>Table of Contents</b>
    </summary>
    <div class="toc "><nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#cmake一般使用流程">CMake<strong>一般使用流程</strong></a>
      <ul>
        <li><a href="#生成构建系统">生成构建系统</a></li>
        <li><a href="#执行构建">执行构建</a></li>
        <li><a href="#执行测试安装或打包">执行测试，安装或打包</a></li>
      </ul>
    </li>
    <li><a href="#cmake基础语法">CMake基础语法</a>
      <ul>
        <li><a href="#注释">注释</a></li>
        <li><a href="#普通变量">普通变量</a></li>
        <li><a href="#cache变量">Cache变量</a></li>
        <li><a href="#环境变量">环境变量</a></li>
        <li><a href="#条件语句">条件语句</a></li>
        <li><a href="#循环语句">循环语句</a></li>
        <li><a href="#函数">函数</a></li>
        <li><a href="#宏">宏</a></li>
        <li><a href="#消息打印">消息打印</a></li>
        <li><a href="#列表操作">列表操作</a></li>
        <li><a href="#文件操作">文件操作</a></li>
        <li><a href="#执行系统命令">执行系统命令</a></li>
        <li><a href="#设置项目和版本">设置项目和版本</a></li>
        <li><a href="#指定编程语言版本">指定编程语言版本</a></li>
        <li><a href="#配置编译选项">配置编译选项</a></li>
        <li><a href="#配置编译类型">配置编译类型</a></li>
        <li><a href="#添加全局宏定义">添加全局宏定义</a></li>
        <li><a href="#添加include目录">添加include目录</a></li>
        <li><a href="#编译目标文件">编译目标文件</a></li>
        <li><a href="#编译生成库文件">编译生成库文件</a></li>
        <li><a href="#编译可执行文件">编译可执行文件</a></li>
      </ul>
    </li>
    <li><a href="#cmake模块化构建">CMake模块化构建</a>
      <ul>
        <li><a href="#定义子目录的构建系统">定义子目录的构建系统</a></li>
        <li><a href="#包含子目录">包含子目录</a></li>
      </ul>
    </li>
    <li><a href="#导入目标文件">导入目标文件</a>
      <ul>
        <li><a href="#导入库文件">导入库文件</a></li>
        <li><a href="#导入可执行文件">导入可执行文件</a></li>
      </ul>
    </li>
    <li><a href="#库依赖">库依赖</a></li>
    <li><a href="#安装">安装</a>
      <ul>
        <li><a href="#install指令"><strong>install指令</strong></a></li>
        <li><a href="#安装构建目标"><strong>安装构建目标</strong></a></li>
        <li><a href="#安装目录"><strong>安装目录</strong></a></li>
        <li><a href="#安装文件">安装文件</a></li>
        <li><a href="#自定义安装脚本">自定义安装脚本</a></li>
        <li><a href="#执行安装">执行安装</a></li>
      </ul>
    </li>
    <li><a href="#打包">打包</a>
      <ul>
        <li><a href="#cpack">CPack</a></li>
        <li><a href="#内置变量">内置变量</a></li>
      </ul>
    </li>
    <li><a href="#编译过程">编译过程</a>
      <ul>
        <li><a href="#预处理">预处理</a></li>
        <li><a href="#编译">编译</a></li>
        <li><a href="#链接">链接</a></li>
      </ul>
    </li>
    <li><a href="#合并静态库">合并静态库</a>
      <ul>
        <li><a href="#基于cmake">基于cmake</a></li>
        <li><a href="#其它方法">其它方法</a></li>
      </ul>
    </li>
    <li><a href="#生成器表达式">生成器表达式</a>
      <ul>
        <li><a href="#布尔生成器表达式">布尔生成器表达式</a></li>
        <li><a href="#字符串值生成器表达式">字符串值生成器表达式</a></li>
        <li><a href="#调试信息">调试信息</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
  </details>
  
  
  <article class="content ">
    
    <h2 id="前言">前言</h2>
<p>CMake是一个跨平台的构建系统，能自动生成各种平台和编译器的构建文件，相对于直接编写 <code>makefile</code> 文件，编写 <code>CMakeLists</code> 文件不需要考虑太多的文件之间的依赖关系，它可以自动帮你管理复杂项目的构建过程，检测依赖关系，生成目标文件，编译静态库和动态库等，减少手动管理的负担</p>
<p>可以看看这个知乎专题 <a href="https://www.zhihu.com/column/c_1369781372333240320">CMake实践应用专题 - 知乎 (zhihu.com)</a> ，下面的内容几乎都是从这里整理的</p>
<h2 id="cmake一般使用流程">CMake<strong class=chinese>一般使用流程</strong></h2>
<h3 id="生成构建系统">生成构建系统</h3>
<p>通过 <code>cmake</code> 指令生成构建系统，可以在命令行中输入 <code>cmake --help</code> 来看到 <code>cmake</code> 指令支持的详细参数，常用参数如下</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>-S</td>
<td>指定源文件根目录，该目录下必须包含 CMakeLists.txt 文件</td>
</tr>
<tr>
<td>-B</td>
<td>指定构建目录，构建生成的中间文件和目标文件的生成路径</td>
</tr>
<tr>
<td>-D</td>
<td>指定变量，格式为 -D <var> = <value>， -D 后的空格可省</td>
</tr>
</tbody>
</table>
<p>例如，使用当前目录为源文件目录，其中包含 <code>CMakeLists.txt</code> 文件，使用 <code>build</code> 目录作为构建目录，设定变量 <code>CMAKE_BUILD_TYPE</code> 为 <code>Debug</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"> cmake -S . -B build -DCMAKE_BUILD_TYPE<span class="o">=</span>Debug
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="执行构建">执行构建</h3>
<p>使用 <code>cmake --build [&lt;dir&gt; | --preset &lt;preset&gt;]</code> 进行构建</p>
<p>这里指定的目录就是生成构建系统时的指定的构建目录，常用的一些参数</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>—target</td>
<td>指定构建目标代替默认的构建目标，可以指定多个</td>
</tr>
<tr>
<td>—parallel / -j[<jobs>]</td>
<td>指定构建目标时使用的进程数</td>
</tr>
</tbody>
</table>
<h3 id="执行测试安装或打包">执行测试，安装或打包</h3>
<p>安装打包的内容可以看后面</p>
<p>测试主要是使用的 <code>gtest</code> 库，所以可以看看我的 <code>gtest</code> 使用的文章</p>
<h2 id="cmake基础语法">CMake基础语法</h2>
<h3 id="注释">注释</h3>
<p>使用 <code>#</code> 开头的行是注释行，会被忽略，块注释为 <code>#[[ ... ]]</code></p>
<h3 id="普通变量">普通变量</h3>
<p>使用 <code>set</code> 指令来<strong class=chinese>定义变量</strong></p>
<pre tabindex="0"><code>set(VALUE_NAME value)
</code></pre><p>使用 <code>$</code> 来读取变量</p>
<pre tabindex="0"><code>${VALUE_NAME}
</code></pre><p>使用 <code>unset</code> 来取消设置变量</p>
<pre tabindex="0"><code>unset(VALUE_NAME)
</code></pre><ol>
<li>如果要设置的变量值包含空格，需要使用双引号把整个或者 <code>\</code> 转义</li>
<li>如果设置多个值或者字符串值的中间有 <code>;</code> ，则保存成 <code>list</code></li>
<li>变量可以被 <code>list</code> 命令操作，单个值的变量相当于只有一个元素的列表</li>
<li>在<code>if()</code>条件判断中可以简化为只用变量名</li>
</ol>
<h3 id="cache变量">Cache变量</h3>
<p>作用是为了提供用户配置选项，若未指定则使用默认值，使用如下方法设置</p>
<pre tabindex="0"><code>set(&lt;variable&gt; &lt;value&gt;... CACHE &lt;type&gt; &lt;docstring&gt; [FORCE])
</code></pre><p>使用 <code>$CACHE</code> 引用变量， <code>CACHE</code> 变量会被保存在构建目录下的 <code>CMakeCache.txt</code> 中，缓存之后是不变的的，除非重新配置</p>
<h3 id="环境变量">环境变量</h3>
<p>修改当前处理进程的环境变量，设置格式如下</p>
<pre tabindex="0"><code>set(ENV{&lt;variable&gt;} [&lt;value&gt;])
</code></pre><p>可以使用 <code>$ENV</code> 来引用环境变量</p>
<h3 id="条件语句">条件语句</h3>
<pre tabindex="0"><code>if(CONDITION1)
	...
elseif(CONDITION2)
	...
else()
	...
endif()
</code></pre><p>用于比较的语法</p>
<ol>
<li>字符串： <code>STREQUAL</code> ， <code>STRLESS</code> ， <code>STRGREATER</code></li>
<li>数值比较： <code>EQUAL</code> ， <code>LESS</code> ， <code>GREATER</code></li>
<li>布尔运算： <code>AND</code> ， <code>OR</code> ， <code>NOT</code></li>
<li>路径判断： <code>EXISTS</code> ， <code>IS_DIRECTORY</code> <strong>，</strong> <code>IS_ABSOLUTE</code></li>
<li>多个条件语句组合： <code>(cond1) AND (cond2 OR (cond3))</code></li>
<li>常量： <code>ON</code> ， <code>YES</code> ， <code>TRUE</code> ， <code>Y</code> 和非 0 值被视为 <code>True</code> ，对于 <code>0</code> ， <code>OFF</code> ， <code>NO</code> ， <code>FALSE</code> ， <code>N</code> ， <code>IGNORE</code> ，空字符串， <code>NOTFOUND</code> ，以及以 <code>-NOTFOUND</code> 结尾的字符串都被视为 <code>False</code></li>
</ol>
<h3 id="循环语句">循环语句</h3>
<p>类似于 <code>python</code> 中的循环语句的定义</p>
<pre tabindex="0"><code>foreach(item IN LISTS items)
	...
endforeach()
</code></pre><h3 id="函数">函数</h3>
<p>可以自定义自己的函数</p>
<pre tabindex="0"><code>function(FUNCTION_NAME arg1 arg2)
	...
endfunction()
</code></pre><h3 id="宏">宏</h3>
<pre tabindex="0"><code>macro(MACRO_NAME arg1 arg2)
	...
endmacro()
</code></pre><h3 id="消息打印">消息打印</h3>
<p>利用 <code>message</code> 指令来把信息打印出来，如下</p>
<pre tabindex="0"><code>message([&lt;mode&gt;] &#34;message text&#34; ... )
</code></pre><p>其中 <code>mode</code> 的选值如下</p>
<ol>
<li>空或者是 <code>NOTICE</code> ：比较重要的信息</li>
<li><code>DEBUG</code> ：调试信息</li>
<li><code>STATUS</code> ：状态信息</li>
<li><code>WARNING</code> ： <code>cmake</code> 警告，不会打断进程</li>
<li><code>SEND_ERROR</code> ： <code>cmake</code> 错误，会继续执行，但是跳过生成构建系统</li>
<li><code>FATAL_ERROR</code> ： <code>cmake</code> 致命错误，会终止进程</li>
</ol>
<h3 id="列表操作">列表操作</h3>
<p>设置多个值或者字符串值的中间有 <code>;</code> ，则保存成 <code>list</code> ， <code>list</code> 存在于 <code>cmake</code> 中，有很多子命令</p>
<ol>
<li><code>APPEND</code> 向列表中添加元素</li>
<li><code>LENGTH</code> 获取列表中元素的个数</li>
<li><code>JOIN</code> 将列表元素用指定的分隔符连接起来</li>
</ol>
<pre tabindex="0"><code>set(LIST A B)
set(LIST A;B)
set(LIST &#34;A;B&#34;)
list(APPEND LIST &#34;C&#34;)
list(LENGTH LIST LIST_LEN)
list(JOIN LIST &#34;,&#34; LIST_SPLIT)
</code></pre><h3 id="文件操作">文件操作</h3>
<p><code>cmake</code> 的 <code>file</code> 命令支持的操作比较多，可以读写，创建或复制文件和目录，计算文件hash，下载文件，压缩文件等，例如</p>
<pre tabindex="0"><code>file(GLOB_RECURSE ALLSRC src/*.c)
</code></pre><p>其中 <code>GLOB_RECURSE</code> 表示执行递归查找，查找目录下的所有符合指定的正则表达式的文件</p>
<h3 id="执行系统命令">执行系统命令</h3>
<p>使用 <code>execute_process</code> 指令可以执行一条或者顺序执行多条系统命令</p>
<p><code>execute_process(COMMAND bash &quot;-c&quot; &quot;git rev-parse --short HEAD&quot; OUTPUT_VARIABLE COMMIT_ID)</code></p>
<p>上述是获取当前仓库最新提交的 <code>commit</code> 的 <code>commit id</code></p>
<h3 id="设置项目和版本">设置项目和版本</h3>
<p>如果需要在项目中<strong>标明版本号、Git的hash号、编译时间</strong>等信息，可以利用 <code>configure_file</code> 来实现</p>
<pre tabindex="0"><code>configure_file(&lt;input&gt; &lt;output&gt;
               [COPYONLY] [ESCAPE_QUOTES] [@ONLY]
               [NEWLINE_STYLE [UNIX|DOS|WIN32|LF|CRLF] ])
</code></pre><p>其中</p>
<ul>
<li><code>input</code> 输入文件，一般是以 <code>.h.in</code> 为后缀</li>
<li><code>output</code> 输出文件，一般是 <code>.h</code> 后缀</li>
<li><code>COPYONLY</code> 只拷贝文件，不进行任何变量替换，与 <code>NEWLINE_STYLE</code> 冲突（指定 <code>NEWLINE_STYLE</code> 之后无效）</li>
<li><code>ESCAPE_QUOTES</code> 避开所有反斜杠的转义</li>
<li><code>@ONLY</code> 限制变量替换，让其只替换被 <code>@VAR@</code> 引用的变量（那么 <code>${VAR}</code> 格式的变量将不会被替换）。这在配置<code>${VAR}</code>语法的脚本时是非常有用的</li>
<li><code>NEWLINE_STYLE</code> 指定输出文件中的新行格式。 <code>UNIX</code> 和 <code>LF</code> 的新行是 <code>\n</code>， <code>DOS</code> 和 <code>WIN32</code> 和 <code>CRLF</code> 的新行格式是 <code>\r\n</code>。这个选项在指定了 <code>COPYONLY</code> 选项时不能使用(无效)</li>
</ul>
<p>在 <code>cmake</code> 教程中对它的解释是将一个文件复制到另一个位置并且修改其内容，这里的修改并非是随意修改，而是**将input文件复制到output文件，并在输入文件内容中的变量，替换引用为@VAR@或${VAR}的变量值。每个变量引用将替换为该变量的当前值，如果未定义该变量，则为空字符串，**如下</p>
<pre tabindex="0"><code>set(BUILD_Version 1)

// input file
#define BUILD_Version @BUILD_Version@

// output file
#define BUILD_Version 1
</code></pre><p>在 <code>CMakeLists.txt</code> 文件中使用 <code>project</code> 指令可以指定版本号</p>
<pre tabindex="0"><code>project(ProjectName VERSION 1.0.0 LANGUAGES C CXX)
</code></pre><p>其中第一个参数为项目名称，并且可以通过 <code>VERSION</code> 指定版本号，格式为 <code>major.minor.patch.tweak</code> 并且 <code>cmake</code> 会将对应的值分别赋给以下变量，如果没有将会是空字符串</p>
<pre tabindex="0"><code>PROJECT_VERSION, &lt;PROJECT-NAME&gt;_VERSION
PROJECT_VERSION_MAJOR, &lt;PROJECT-NAME&gt;_VERSION_MAJOR
PROJECT_VERSION_MINOR, &lt;PROJECT-NAME&gt;_VERSION_MINOR
PROJECT_VERSION_PATCH, &lt;PROJECT-NAME&gt;_VERSION_PATCH
PROJECT_VERSION_TWEAK, &lt;PROJECT-NAME&gt;_VERSION_TWEAK
</code></pre><p>利用上述的 <code>configure_file</code> 命令可以配置自动生成版本头文件，将头文件版本号定义成对应的宏，或者定义为接口，便于了解当前版本</p>
<h3 id="指定编程语言版本">指定编程语言版本</h3>
<p>可以使得在不同的机器上都能够有统一的编译，可以指定语言版本</p>
<pre tabindex="0"><code>set(CMAKE_C_STANDARD 99)
set(CMAKE_CXX_STANDARD 11)
</code></pre><p><code>CMAKE_</code> ， <code>_CMAKE</code> 或者是下划线开头后面加上任意 <code>cmake</code> 命令的变量名都是 <code>cmake</code> 保留的，都是 <code>cmake</code> 的内置变量，可以通过修改这些变量的值来配置 <code>cmake</code> 的构建</p>
<h3 id="配置编译选项">配置编译选项</h3>
<p>通过指令 <code>add_compile_options</code> 指令可以为所有编译器配置编译选项，同时对多个编译器有效</p>
<pre tabindex="0"><code>add_compile_options(-g -Wall -Werror)
</code></pre><p>通过设置变量 <code>CMAKE_C_FLAGS</code> 可以配置 C 编译器的编译选项</p>
<pre tabindex="0"><code>set(CMAKE_C_FLAGS &#34;${CMAKE_C_FLAGS} -pipe -std=c99&#34;)
</code></pre><p>而设置变量 <code>CMAKE_CXX_FLAGS</code> 可以配置 C++ 编译器的选项</p>
<pre tabindex="0"><code>set(CMAKE_CXX_FLAGS &#34;${CMAKE_CXX_FLAGS} -pipe -std=c++11&#34;)
</code></pre><h3 id="配置编译类型">配置编译类型</h3>
<p>通过设置变量 <code>CMAKE_BUILD_TYPE</code> 来配置编译类型，可以设置为 <code>Debug</code> ， <code>Release</code> ， <code>RelWithDebInfo</code> ， <code>MinSizeRel</code> 等</p>
<pre tabindex="0"><code>set(CMAKE_BUILD_TYPE Debug)
</code></pre><p>也可以在执行 <code>cmake</code> 命令的时候通过参数 <code>-D</code> 来指定， <code>cmake</code> 会检查是否有对应编译类型的编译选项，如果有就将它的内容追加到其中</p>
<p>对于不同的编译类型可以设置不同的编译选项，比如对于 <code>Debug</code> 类型，开启调试信息</p>
<pre tabindex="0"><code>set(CMAKE_C_FLAGS_DEBUG &#34;${CMAKE_C_FLAGS_DEBUG} -g&#34;)
set(CMAKE_CXX_FLAGS_DEBUG &#34;${CMAKE_CXX_FLAGS_DEBUG} -g&#34;)
</code></pre><h3 id="添加全局宏定义">添加全局宏定义</h3>
<p>通过命令 <code>add_definitions</code> 可以添加全局的宏定义，在源代码中就可以通过判断不同的宏定义来实现相应的代码逻辑，例如</p>
<pre tabindex="0"><code>add_definitions(-DDEBUG -DREAL_COOL_ENGINEER)
</code></pre><h3 id="添加include目录">添加include目录</h3>
<p>通过命令 <code>include_directories</code> 来设置头文件的搜索目录</p>
<pre tabindex="0"><code>include_directories(.) # 表示所有的头文件
include_directories(inc/)
</code></pre><h3 id="编译目标文件">编译目标文件</h3>
<p>一般来说，编译目标的类型一般有静态库，动态库和可执行文件，编写 <code>CMakeLists.txt</code> 主要包括两步</p>
<ul>
<li>编译：确定编译目标所需要的源文件</li>
<li>链接：确定链接的时候需要依赖的额外的库</li>
</ul>
<h3 id="编译生成库文件">编译生成库文件</h3>
<p>将项目目录路径下的源文件编译为静态库，需要获取编译此静态库需要的文件列表，可以使用<code>set</code>命令，或者<code>file</code>命令来进行设置</p>
<pre tabindex="0"><code>file(GLOB_RECURSE FUNCTION_LIB_SRC /function/*.c)
# set(FUNCTION_LIB_SRC /function/*.c)
add_library(function_lib STATIC ${FUNCTION_LIB_SRC })
</code></pre><p>其中使用 <code>add_library</code> 指令编译名为 <code>function_lib</code> 的静态库，第二个参数表示库的类型， <code>STATIC</code> 表示静态链接库， <code>SHARED</code> 表示动态链接库</p>
<h3 id="编译可执行文件">编译可执行文件</h3>
<p>通过 <code>add_executable</code> 命令来向构建系统中添加一个可执行构建目标，指定编译需要的源文件。但是对于可执行文件来说，有时候还会依赖其它的库则需要使用 <code>target_link_libraries</code> 命令来声明构建此可执行文件需要链接的库</p>
<pre tabindex="0"><code>add_executable(demo main.c)
target_link_libraries(demo function_lib)
</code></pre><h2 id="cmake模块化构建">CMake模块化构建</h2>
<p><code>CMakeLists.txt</code> 是定义一个目录的构建系统，所谓的模块化构建是分别为每一个子模块目录编写一个 <code>CMakeLists.txt</code> 文件，并且在其上层目录中导入子目录构建系统生成对应的目标，以便在上层目录中使用</p>
<p>这里使用的是一个 <code>cmake</code> 模板的开源项目 <a href="https://gitee.com/RealCoolEngineer/cmake-template">cmake-template-gitee</a></p>
<p>在这个项目中，将 <code>math</code> 目录视为子模块，为其单独定义构建系统，而整个项目的编译依赖于 <code>math</code> 模块的编译结果来生成其它目标文件</p>
<h3 id="定义子目录的构建系统">定义子目录的构建系统</h3>
<p>在需要构建的子目录下创建一个 <code>CMakeLists.txt</code> 文件，在其中写入的内容只需要<strong class=chinese>编译构建库文件</strong>，以及针对对外提供的接口的功能进行测试就行</p>
<p>对于子目录，也有自己的 <code>project</code> 指令，同时可以指定自己的版本号</p>
<p><code>aux_source_directory</code> 可以搜索指定目录（第一个参数）下的所有源文件，将源文件的列表保存到指定的变量（第二个参数）</p>
<p>在 <code>src/math</code> 目录下新建  <code>CMakeLists.txt</code> 文件，写入内容，将其编译为一个静态链接库</p>
<pre tabindex="0"><code>project(CMakeTemplateMath VERSION 0.0.1 LANGUAGES C CXX)

aux_source_directory(. MATH_SRC)
message(&#34;MATH_SRC: ${MATH_SRC}&#34;)

add_library(math STATIC ${MATH_SRC})
</code></pre><h3 id="包含子目录">包含子目录</h3>
<p>使用 <code>add_subdirectory</code> 命令可以包含一个子目录的构建系统，如下</p>
<pre tabindex="0"><code>add_subdirectory(dir [binary_dir] [EXCLUDE_FROM_ALL])
</code></pre><p>其中</p>
<ol>
<li><code>dir</code> 就是需要包含的目标目录，该目录下必须存在一个 <code>CMakeLists.txt</code> 文件，一般相对于当前的 <code>CMakeLists.txt</code> 的目录路径，也可以是绝对路径</li>
<li><code>binary_dir</code> 是可选的参数，用于指定子构建系统输出文件的路径，相对于当前的 <code>binary_tree</code> ，也可以是绝对路径。如果 <code>dir</code> 是当前目录的子目录，那 <code>binary_dir</code> 是不做任何相对路径展开的 <code>dir</code> ，但是如果 <code>dir</code> 不是当前的子目录，必须指定 <code>binary_dir</code> ， 从而 <code>cmake</code> 才能确定文件的生成目录</li>
<li><code>EXCLUDE_FROM_ALL</code> 如果指定了，那子路径下的目标默认不会被包含到父路径的 ALL 目标里，并且也会被排除在工程文件之外，但是如果在父级项目显式声明依赖子目录的目标文件，那么对应的目标文件还是会被构建以满足父级项目的依赖需求</li>
</ol>
<p>可以在根目录下的 <code>CMakeLists.txt</code> 写入命令来链接编译的静态库</p>
<pre tabindex="0"><code>add_subdirectory(src/c/math)
add_executable(demo src/c/main.c)
target_link_libraries(demo math)
</code></pre><p>而且此时构建和编译的命令没有任何改变，依旧是在终端中输入 <code>cmake</code> 指令</p>
<h2 id="导入目标文件">导入目标文件</h2>
<p>上述中所用的 <code>add_subdirectory</code> 方法实际上就是通过源文件来构建项目所依赖的目标文件，但是在 <code>cmake</code> 中也可以通过命令导入已经编译好的目标文件</p>
<h3 id="导入库文件">导入库文件</h3>
<p>使用 <code>add_library</code> 指令可以通过指定 <code>IMPORTED</code> 选项表明是一个导入的库文件，通过 <code>set_property</code> 设置属性来指明路径</p>
<pre tabindex="0"><code>add_library(math STATIC IMPORTED)
set_property(TARGET math PROPERTY 
						IMPORTED_LOCATION &#34;./lib/libmath.a&#34;)
</code></pre><p>也可以使用 <code>find_library</code> 命令来查找，比如在 <code>lib</code> 目录下查找 <code>math</code> 的 <code>Realse</code> 版本和 <code>Debug</code> 版本</p>
<pre tabindex="0"><code>find_library(LIB_MATH_DEBUG mathd HINTS &#34;./lib&#34;)
find_library(LIB_MATH_RELEASE math HINTS &#34;./lib&#34;)
</code></pre><p>可以通过指令 <code>set_target_properties</code> 来设置不同的编译选项，例如</p>
<pre tabindex="0"><code>set_target_properties(math PROPERTIES
  IMPORTED_LOCATION &#34;${LIB_MATH_RELEASE}&#34;
  IMPORTED_LOCATION_DEBUG &#34;${LIB_MATH_DEBUG}&#34;
  IMPORTED_CONFIGURATIONS &#34;RELEASE;DEBUG&#34;
)
</code></pre><p>导入之后，就可以将该库链接到其它目标上，但是导入该库的目标不能被 <code>install</code></p>
<h3 id="导入可执行文件">导入可执行文件</h3>
<p>在 <code>add_executable</code> 通过指定 <code>IMPORTED</code> 来指定可执行文件是外部导入的</p>
<pre tabindex="0"><code>add_executable(demo IMPORTED)
set_property(TARGET demo PROPERTY
             IMPORTED_LOCATION &#34;./bin/demo&#34;)
</code></pre><h2 id="库依赖">库依赖</h2>
<p>主要是对于 <code>target_link_libraries</code> 命令的几个关键字，就是目标文件依赖项的使用范围，对于两个动态链接库 <code>[a.so](http://a.so)</code> 和 <code>b.so</code></p>
<ul>
<li><code>PRIVATE</code> 就是 <code>a</code> 使用了 <code>b</code> ，但是并不对外暴漏 <code>b</code> 的接口</li>
<li><code>INTERFACE</code> 就是 <code>a</code> 未使用 <code>b</code> ，但是对外暴漏 <code>b</code> 的接口</li>
<li><code>PUBLIC</code> 就是 <code>a</code> 使用了 <code>b</code> 并且对外暴漏 <code>b</code> 的接口</li>
</ul>
<pre tabindex="0"><code>target_link_libraries(a PRIVATE/INTERFACE/PUBLIC b)
target_include_directories(a PRIVATE/INTERFACE/PUBLIC b)
</code></pre><h2 id="安装">安装</h2>
<h3 id="install指令"><strong>install指令</strong></h3>
<p>安装时使用 <code>install</code> 指令，用于指定一个项目的安装规则，命令格式如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">install</span><span class="p">(</span><span class="n">TARGETS</span> <span class="o">&lt;</span><span class="n">target</span><span class="o">&gt;</span><span class="p">...</span> <span class="p">[...])</span>
</span></span><span class="line"><span class="cl"><span class="n">install</span><span class="p">({</span><span class="n">FILES</span> <span class="o">|</span> <span class="n">PROGRAMS</span><span class="p">}</span> <span class="o">&lt;</span><span class="n">file</span><span class="o">&gt;</span><span class="p">...</span> <span class="p">[...])</span>
</span></span><span class="line"><span class="cl"><span class="n">install</span><span class="p">(</span><span class="n">DIRECTORY</span> <span class="o">&lt;</span><span class="n">dir</span><span class="o">&gt;</span><span class="p">...</span> <span class="p">[...])</span>
</span></span><span class="line"><span class="cl"><span class="n">install</span><span class="p">(</span><span class="n">SCRIPT</span> <span class="o">&lt;</span><span class="n">file</span><span class="o">&gt;</span> <span class="p">[...])</span>
</span></span><span class="line"><span class="cl"><span class="n">install</span><span class="p">(</span><span class="n">CODE</span> <span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span> <span class="p">[...])</span>
</span></span><span class="line"><span class="cl"><span class="n">install</span><span class="p">(</span><span class="n">EXPORT</span> <span class="o">&lt;</span><span class="k">export</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="p">[...])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看出 <code>install</code> 命令可以安装的目标类型为：构建目标、文件、程序、目录等，对应的关键字后面跟上对应要安装的目标，安装不同目标时有一些通用的关键字
<strong>DESTINATION</strong></p>
<p>就是安装对象的目标安装路径，可以是绝对路径，也可以是相对路径</p>
<pre tabindex="0"><code>install(TARGETS function_lib
        RUNTIME DESTINATION bin
        LIBRARY DESTINATION lib
        ARCHIVE DESTINATION lib)
</code></pre><p>其中</p>
<ul>
<li><code>TARGETS</code> 用于指定需要安装的目标</li>
<li><code>RUNTIME DESTINATION</code> 指定可执行文件的安装路径</li>
<li><code>LIBRARY DESTINATION</code> 指定共享库文件的安装路径</li>
<li><code>ARCHIVE DESTINATION</code> 指定静态库文件的安装路径</li>
</ul>
<p>如果指定 <code>CMAKE_INSTALL_PREFIX</code> 目录之后，那库文件将会被安装在对应目录下的 <code>lib</code> 文件夹中，可执行文件将会被安装在对应目录下的 <code>bin</code> 文件夹中，不同类型的目标文件安装到不同子目录。需要注意的是， <code>CMAKE_INSTALL_PREFIX</code> 在不同的系统上会有不同的默认值，使用时最好显式指定</p>
<p>头文件也可以使用上述的命令安装</p>
<p><strong>CONFIGURATIONS</strong></p>
<p>为不同的配置设置不同的安装规则，例如对于 <code>Debug</code> 和 <code>Release</code> 配置不同的安装路径，如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">install</span><span class="p">(</span><span class="n">TARGETS</span> <span class="n">target</span>
</span></span><span class="line"><span class="cl">        <span class="n">CONFIGURATIONS</span> <span class="n">Debug</span>
</span></span><span class="line"><span class="cl">        <span class="n">RUNTIME</span> <span class="n">DESTINATION</span> <span class="n">Debug</span><span class="o">/</span><span class="n">bin</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">install</span><span class="p">(</span><span class="n">TARGETS</span> <span class="n">target</span>
</span></span><span class="line"><span class="cl">        <span class="n">CONFIGURATIONS</span> <span class="n">Release</span>
</span></span><span class="line"><span class="cl">        <span class="n">RUNTIME</span> <span class="n">DESTINATION</span> <span class="n">Release</span><span class="o">/</span><span class="n">bin</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>PERMISSIONS</strong></p>
<p>设置安装目标权限，接受的是一个权限关键字列表，例如</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">install</span><span class="p">(</span><span class="n">TARGETS</span> <span class="n">target</span>
</span></span><span class="line"><span class="cl">        <span class="n">RUNTIME</span> <span class="n">PERMISSIONS</span> <span class="n">OWNER_READ</span> <span class="n">OWNER_WRITE</span> <span class="n">OWNER_EXECUTE</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="安装构建目标"><strong class=chinese>安装构建目标</strong></h3>
<p>安装一个构建好的目标，命令格式为</p>
<pre tabindex="0"><code>install(TARGETS function_lib
        RUNTIME DESTINATION bin
        LIBRARY DESTINATION lib
        ARCHIVE DESTINATION lib)
</code></pre><p>完整的命令格式为</p>
<pre tabindex="0"><code>install(TARGETS targets... [EXPORT &lt;export-name&gt;]
        [[ARCHIVE|LIBRARY|RUNTIME|OBJECTS|FRAMEWORK|PRIVATE_HEADER|PUBLIC_HEADER|RESOURCE]
         [DESTINATION &lt;dir&gt;]
         [PERMISSIONS permissions...]
         [CONFIGURATIONS [Debug|Release|...]]
         [COMPONENT &lt;component&gt;]
         [NAMELINK_COMPONENT &lt;component&gt;]
         [OPTIONAL] [EXCLUDE_FROM_ALL]
         [NAMELINK_ONLY|NAMELINK_SKIP]
        ] [...]
        [INCLUDES DESTINATION [&lt;dir&gt; ...]]
        )
</code></pre><p>其中参数中的<code>TARGET</code>可以是很多种目标文件，最常见的是通过 <code>ADD_EXECUTABLE</code> 或者 <code>ADD_LIBRARY</code> 定义的目标文件，即可执行二进制，动态库，静态库</p>
<table>
<thead>
<tr>
<th>目标文件</th>
<th>内容</th>
<th>安装目录变量</th>
<th>默认安装文件夹</th>
</tr>
</thead>
<tbody>
<tr>
<td>ARCHIVE</td>
<td>静态库</td>
<td>${CMAKE_INSTALL_LIBDIR}</td>
<td>lib</td>
</tr>
<tr>
<td>LIBRARY</td>
<td>动态库</td>
<td>${CMAKE_INSTALL_LIBDIR}</td>
<td>lib</td>
</tr>
<tr>
<td>RUNTIME</td>
<td>可执行二进制文件</td>
<td>${CMAKE_INSTALL_BINDIR}</td>
<td>bin</td>
</tr>
<tr>
<td>PUBLIC_HEADER</td>
<td>与库关联的PUBLIC头文件</td>
<td>${CMAKE_INSTALL_INCLUDEDIR}</td>
<td>include</td>
</tr>
<tr>
<td>PRIVATE_HEADER</td>
<td>与库关联的PRIVATE头文件</td>
<td>${CMAKE_INSTALL_INCLUDEDIR}</td>
<td>include</td>
</tr>
</tbody>
</table>
<h3 id="安装目录"><strong class=chinese>安装目录</strong></h3>
<p>安装一个目录，一般用于将头文件安装到目标路径，实际中，一般将需要安装的头文件放在一个特定的目录下，然后直接安装整个目录，如下</p>
<pre tabindex="0"><code>install(DIRECTORY &#34;${PROJECT_SOURCE_DIR}/include/&#34;
	      DESTINATION &#34;${CMAKE_INSTALL_INCLUDEDIR}&#34;)
</code></pre><p>更加完整的命令格式为</p>
<pre tabindex="0"><code>install(DIRECTORY dirs...
        TYPE &lt;type&gt; | DESTINATION &lt;dir&gt;
        [FILES_MATCHING]
        [[PATTERN &lt;pattern&gt; | REGEX &lt;regex&gt;]
         [EXCLUDE] [PERMISSIONS permissions...]])
</code></pre><p><strong>TYPE/DESTINATION</strong></p>
<p>安装目录必须指定安装的目录类型 <code>TYPE</code> 或者安装的目标路径 <code>DESTINATION</code> ，但是不可以同时指定， <code>TYPE</code> 用于指定安装的目录中的文件类型，并且 <code>cmake</code> 会自动按照类型分配安装位置，不同类型对应的安装路径如下</p>
<table>
<thead>
<tr>
<th>TYPE类型</th>
<th>安装目录变量</th>
<th>默认安装文件夹</th>
</tr>
</thead>
<tbody>
<tr>
<td>BIN</td>
<td>${CMAKE_INSTALL_BINDIR}</td>
<td>bin</td>
</tr>
<tr>
<td>SBIN</td>
<td>${CMAKE_INSTALL_SBINDIR}</td>
<td>sbin</td>
</tr>
<tr>
<td>LIB</td>
<td>${CMAKE_INSTALL_LIBDIR}</td>
<td>lib</td>
</tr>
<tr>
<td>INCLUDE</td>
<td>${CMAKE_INSTALL_INCLUDEDIR}</td>
<td>include</td>
</tr>
<tr>
<td>SYSCONF</td>
<td>${CMAKE_INSTALL_SYSCONFDIR}</td>
<td>etc</td>
</tr>
<tr>
<td>SHAREDSTATE</td>
<td>${CMAKE_INSTALL_SHARESTATEDIR}</td>
<td>com</td>
</tr>
<tr>
<td>LOCALSTATE</td>
<td>${CMAKE_INSTALL_LOCALSTATEDIR}</td>
<td>var</td>
</tr>
<tr>
<td>RUNSTATE</td>
<td>${CMAKE_INSTALL_RUNSTATEDIR}</td>
<td>/run</td>
</tr>
<tr>
<td>DATA</td>
<td>${CMAKE_INSTALL_DATADIR}</td>
<td></td>
</tr>
<tr>
<td>INFO</td>
<td>${CMAKE_INSTALL_INFODIR}</td>
<td>/info</td>
</tr>
<tr>
<td>LOCALE</td>
<td>${CMAKE_INSTALL_LOCALEDIR}</td>
<td>/locale</td>
</tr>
<tr>
<td>MAN</td>
<td>${CMAKE_INSTALL_MANDIR}</td>
<td>/man</td>
</tr>
<tr>
<td>DOC</td>
<td>${CMAKE_INSTALL_DOCDIR}</td>
<td>/doc</td>
</tr>
</tbody>
</table>
<p>也可以选择使用 <code>DESTINATION</code> 显式指定安装目录</p>
<p><strong>FILES_MATCHING</strong></p>
<p>安装目录的时候默认会安装所有的文件，如果使用 <code>FILES_MATCHING</code> 关键字（在第一个 <code>PATTERN</code> 或者 <code>REGEX</code> 之前），则表示必须要满足对应的模式或者正则的文件才能被安装</p>
<p>例如，对于安装一个目录下的头文件，但是头文件与源文件混合，如下</p>
<pre tabindex="0"><code>install(DIRECTORY src/ DESTINATION include/
        FILES_MATCHING PATTERN &#34;*.h&#34;)
</code></pre><p><strong>PATTERN/REGEX</strong></p>
<ul>
<li><code>PATTERN</code> 文件名完全一致才会被安装</li>
<li><code>REGEX</code> 通过正则表达式匹配之后才会安装</li>
</ul>
<p>在这两个表达式后面还可以加上 <code>EXCLUDE</code> 表示反选，或者使用 <code>PERMISSIONS</code> 指定匹配的目标文件的权限</p>
<h3 id="安装文件">安装文件</h3>
<p>与安装目录类似，命令格式为</p>
<pre tabindex="0"><code>install(&lt;FILES|PROGRAMS&gt; files...
        TYPE &lt;type&gt; | DESTINATION &lt;dir&gt;
</code></pre><ul>
<li><code>FILE</code> 指的是文件的默认权限是一般文件</li>
<li><code>PROGRAMS</code> 指的是文件为可执行文件，默认有可执行权限</li>
</ul>
<h3 id="自定义安装脚本">自定义安装脚本</h3>
<p>使用 <code>install</code> 命令可以在安装的时候执行自定义脚本，格式为</p>
<pre tabindex="0"><code>install([[SCRIPT &lt;file&gt;] [CODE &lt;code&gt;]]
        [COMPONENT &lt;component&gt;] [EXCLUDE_FROM_ALL] [...])
</code></pre><p>其中</p>
<ul>
<li><code>SCRIPT</code> 指定安装时需要执行的脚本</li>
<li><code>CODE</code> 指定的是 <code>cmake</code> 的指令，也就是在安装期间执行的 <code>cmake</code> 指令</li>
</ul>
<h3 id="执行安装">执行安装</h3>
<p>在构建编译完成之后，执行命令安装</p>
<pre tabindex="0"><code>cmake --build . --target install
</code></pre><p>针对 <code>make</code> 工具，安装的指令为</p>
<pre tabindex="0"><code>make install
</code></pre><p>在 <code>cmake-3.15</code> 之后，可以使用如下指令安装</p>
<pre tabindex="0"><code>cmake --install . --prefix &#34;../output&#34;
</code></pre><p>其中 <code>--install</code> 指定构建目录， <code>--prefix</code> 指定安装路径，指定之后会覆盖安装路径变量 <code>CMAKE_INSTALL_PREFIX</code></p>
<h2 id="打包">打包</h2>
<h3 id="cpack">CPack</h3>
<p>使用打包功能，需要先使用命令 <code>include(CPack)</code> 启用相关的功能，构建之后会在构建目录下生成两个 <code>cpack</code> 配置文件，<code>CPackConfig.cmake</code>和<code>CPackSourceConfig.cmake</code> ，分别对应着 <code>package</code> 和 <code>package_source</code></p>
<p>在执行构建编译之后使用 <code>cpack</code> 命令行工具进行打包安装。可以使用 <code>-G</code> 参数指定生成器，常用的为 <code>ZIP</code> ， <code>TGZ</code> ， <code>7Z</code> 等，也可以同时指定多种类型，利用 <code>CMake</code> 语法中的列表，在构建目录下使用如下指令</p>
<pre tabindex="0"><code>cpack -G ZIP --config CPackConfig.cmake
cpack -G ZIP --config CPackSourceConfig.cmake
</code></pre><p>对于 <code>cmake</code> 指令，可以在构建目录下使用如下指令</p>
<pre tabindex="0"><code>cmake --build . --target package
cmake --build . --target package_source
</code></pre><p>对于 <code>make</code> 工具，也可以使用命令 <code>make package</code> 或者 <code>make package_source</code> 进行打包安装</p>
<h3 id="内置变量">内置变量</h3>
<p>打包的内容就是 <code>install</code> 指令安装的内容，还需要设置一些变量</p>
<table>
<thead>
<tr>
<th>变量</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>CPACK_GENERATOR</td>
<td>打包使用的工具</td>
</tr>
<tr>
<td>CPACK_OUTPUT_FILE_PREFIX</td>
<td>打包安装的路径前缀，如果是相对路径，那就是相对于构建路径</td>
</tr>
<tr>
<td>CPACK_INSTALL_PREFIX</td>
<td>打包压缩包的内部目录</td>
</tr>
<tr>
<td>CPACK_PACKAGE_FILE_NAME</td>
<td>打包压缩包的名称，由CPACK_PACKAGE_NAME，CPACK_PACKAGE_VERSION，CPACK_SYSTEM_NAME三部分构成</td>
</tr>
<tr>
<td>CPACK_SET_DESTDIR</td>
<td>如果没有 CPACK_SET_DESTDIR，CPack 使用 CPACK_PACKAGING_INSTALL_PREFIX 作为前缀，而设置 CPACK_SET_DESTDIR 后，CPack 将使用 CMAKE_INSTALL_PREFIX 作为前缀。</td>
</tr>
<tr>
<td>CPACK_OUTPUT_CONFIG_FILE</td>
<td>配置文件，默认为CPackConfig.cmake</td>
</tr>
<tr>
<td>CPACK_PACKAGE_VERSION</td>
<td>默认为项目版本号，默认值为 project 所设置的版本号，如果没有设置就是 cmake 的默认值</td>
</tr>
</tbody>
</table>
<p><code>cpack</code> 有一些参数是可以覆盖 <code>CMakeLists.txt</code> 中所设置的参数的，所以一般来说以上变量的设置在 <code>include(CPack)</code> 之前</p>
<h2 id="编译过程">编译过程</h2>
<p>实际上 <code>cmake</code> 的编译过程中的命令与 <code>gcc</code> 的编译过程是有关联的</p>
<h3 id="预处理">预处理</h3>
<p>可以使用下列指令定义一个宏定义</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">add_definitions<span class="o">(</span>-Dname<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="编译">编译</h3>
<p>使用如下指令给编译过程添加编译选项</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">add_compile_options<span class="o">(</span>-O0 -g ...<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>需要注意的是，因为CMake的构建目标必须是库或者可执行文件，并没有命令仅生成 <code>.o</code> 文件。如果使用生成器表达式的话，对于多个编译选项，需要使用双引号把生成器表达式括起来，且在选项之间使用分号隔开</p>
<h3 id="链接">链接</h3>
<p>使用如下指令来进行指定编译过程中的链接参数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">add_link_options<span class="o">(</span>-pthread ...<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="合并静态库">合并静态库</h2>
<h3 id="基于cmake">基于cmake</h3>
<p><code>**add_custom_command</code>**</p>
<p>向目标添加规则，并通过执行命令生成输出。</p>
<pre tabindex="0"><code>add_custom_command(OUTPUT output1 [output2 ...]
                   COMMAND command1 [ARGS] [args1...]
                   [COMMAND command2 [ARGS] [args2...] ...]
                   [MAIN_DEPENDENCY depend]
                   [DEPENDS [depends...]]
                   [BYPRODUCTS [files...]]
                   [IMPLICIT_DEPENDS &lt;lang1&gt; depend1
                                    [&lt;lang2&gt; depend2] ...]
                   [WORKING_DIRECTORY dir]
                   [COMMENT comment]
                   [DEPFILE depfile]
                   [JOB_POOL job_pool]
                   [VERBATIM] [APPEND] [USES_TERMINAL]
                   [COMMAND_EXPAND_LISTS])
</code></pre><p>其中</p>
<ul>
<li>OUTPUT：指定命令预期生成的输出文件。3.20版本以后，输出参数可使用一组受限的生成器表达式。</li>
<li>COMMAND：指定生成时要执行的命令行。</li>
<li>MAIN_DEPENDENCY：指定命令的主输入源文件。类似于DEPENDS。</li>
<li>DEPENDS：指定命令所依赖的文件。</li>
<li>BYPRODUCTS：指定命令预期生成的文件，但其修改时间可能比依赖项的新，也可能不比依赖项的新。</li>
<li>IMPLICIT_DEPENDS：请求扫描输入文件的隐式依赖项。此选项不能与DEPFILE选项同时指定。</li>
<li>WORKING_DIRECTORY：指定在何处执行命令。</li>
<li>COMMENT：指定在生成时执行命令之前显示的消息。</li>
<li>DEPFILE：指定保存自定义命令依赖项的depfile。它通常由自定义命令本身发出。仅当生成器支持此关键字时，才能使用此关键字。</li>
<li>JOB_POOL：为Ninja生成器指定一个池。</li>
<li>VERBATIM：对于构建工具，命令的所有参数都将被正确转义，以便被调用的命令接收到的每个参数不变。请注意，在add_custom_command甚至看到参数之前，CMake语言处理器仍然使用一级转义。建议使用VERBATIM，因为它可以保证正确的行为。如果不指定VERBATIM，则行为是依赖于平台的，因为CMake没有针对于特定工具中特殊字符的保护措施。</li>
<li>APPEND：将COMMAND和DEPENDS 附加到第一个指定输出的自定义命令。</li>
<li>USES_TERMINAL：如果可能，该命令将被授予直接访问终端的权限。</li>
<li>COMMAND_EXPAND_LISTS：命令参数中的列表将展开，包括使用生成器表达式创建的列表</li>
</ul>
<p><strong><code>add_custom_target</code></strong></p>
<p>在很多时候，需要在<code>cmake</code>中创建一些目标，如<code>clean</code>、<code>copy</code>等等，这就需要通过<code>add_custom_target</code>来指定。同时，<code>add_custom_command</code>可以用来完成对<code>add_custom_target</code>生成的<code>target</code>的补充</p>
<p>用于增加一个没有输出的目标，使得它总是被构建</p>
<pre tabindex="0"><code>add_custom_target(Name [ALL] [command1 [args1...]]
                  [COMMAND command2 [args2...] ...]
                  [DEPENDS depend depend depend ... ]
                  [BYPRODUCTS [files...]]
                  [WORKING_DIRECTORY dir]
                  [COMMENT comment]
                  [JOB_POOL job_pool]
                  [VERBATIM] [USES_TERMINAL]
                  [COMMAND_EXPAND_LISTS]
                  [SOURCES src1 [src2...]])
</code></pre><p>其中</p>
<ul>
<li>ALL：表明该目标会被添加到默认的构建目标，使得它每次都被运行</li>
<li>COMMAND：指定要在构建时执行的命令行；</li>
<li>DEPENDS：指定命令所依赖的文件；</li>
<li>COMMENT：在构建时执行命令之前显示给定消息；</li>
<li>WORKING_DIRECTORY：使用给定的当前工作目录执行命令。如果它是相对路径，它将相对于对应于当前源目录的构建树目录；</li>
<li>BYPRODUCTS：指定命令预期产生的文件。</li>
</ul>
<p><strong class=chinese>具体流程</strong></p>
<ol>
<li>
<p>合并静态库</p>
<p>利用 <code>add_custom_command</code> 配合 <code>add_custom_target</code> 命令，将 <code>liba.a</code> 和 <code>libb.a</code> 合并为 <code>libmerge.a</code></p>
<p>对于 macos 系统中，在根目录下的 <code>CMakeLists.txt</code> 文件中写入</p>
<pre tabindex="0"><code>add_custom_command(OUTPUT libmerge.a
									COMMAND libtool -static -o libmerge.a $&lt;TARGET_FILE:math&gt; $&lt;TARGET_FILE:nn&gt;
									DEPENDS a b)
</code></pre><p>对于其它系统中，在根目录下的 <code>CMakeLists.txt</code> 文件中写入</p>
<pre tabindex="0"><code>add_custom_command(OUTPUT libmerge.a
							    COMMAND ar crsT libmerge.a $&lt;TARGET_FILE:math&gt; $&lt;TARGET_FILE:nn&gt;
							    DEPENDS a b)
</code></pre><p>还需要在后面添加一句，且必须得有</p>
<pre tabindex="0"><code>add_custom_target(_merge ALL DEPENDS libmerge.a)
</code></pre><p>在合并静态库时，需要知道每个静态库的路径，在 <code>cmake</code> 中，目标静态库 <code>a</code> 的路径可以通过生成器表达式 <code>$&lt;TARGET_FILE:a&gt;</code> 获取</p>
<p>如果使用 <code>find_library</code>  查找到的静态库，这时候就 <code>DEPENDS</code> 不需要加入 c ，如下</p>
<pre tabindex="0"><code>find_library(LIB_C c HINTS ${SEARCH_PATH})
</code></pre></li>
<li>
<p>导入合并的静态库</p>
<p>把静态库导入，并且链接到可执行程序使用</p>
<pre tabindex="0"><code>add_library(merge STATIC IMPORTED GLOBAL)
set_target_properties(merge PROPERTIES
    IMPORTED_LOCATION ${CMAKE_CURRENT_BINARY_DIR}/libmerge.a
)
add_executable(main src/c/main.c)
target_link_libraries(main PRIVATE merge)
</code></pre><p>由于 <code>libmerge</code> 是由 <code>add_custom_command</code> 指定的输出，所以会标记为自动生成的文件 <code>GENERATED</code></p>
<p>链接项目中依赖于导入的静态库文件 <code>merge</code> ，而对于 <code>merge</code> 被指定了 <code>IMPORTED_LOCATION</code> ，也就是被指定为自动生成的，所以 cmake 就会等待 <code>libmerge.a</code> 生成之后再进行链接</p>
</li>
</ol>
<h3 id="其它方法">其它方法</h3>
<ol>
<li>
<p>方法1</p>
<p>先使用 <code>ar</code> 把静态库 <code>liba</code> 和 <code>libb</code> 拆解为多个 <code>.o</code> 文件</p>
<pre tabindex="0"><code>ar x liba.a
ar x libb.a
</code></pre><p>再把所有的 <code>.o</code> 文件打包为一个静态库</p>
<pre tabindex="0"><code>ar crs libmerge.a *.o
</code></pre><p>其中</p>
<ul>
<li><code>x</code> 拆解静态库文件为其包含的内容</li>
<li><code>c</code> 封装 <code>.o</code> 文件为静态库文件</li>
<li><code>r</code> 覆盖同名库文件或者创建新的目标库文件</li>
<li><code>s</code> 相当于对结果执行一次 <code>ranlib</code> 为静态库的内容添加索引，以此提高访问效率</li>
</ul>
</li>
<li>
<p>方法2</p>
<p>上述方法1中一个更简洁的表达</p>
<pre tabindex="0"><code>ar crsT libmerge.a liba.a libb.a
</code></pre><p>其中</p>
<ul>
<li><code>T</code> 表示将后续所有静态库中的 <code>.o</code> 文件打包到第一个参数指定的静态库文件中。如果不加该参数，得到的将会是后面几个 <code>.a</code> 文件的集合</li>
<li>可以使用 <code>ar -t</code> 查看打包的内容</li>
</ul>
</li>
<li>
<p>方法3</p>
<p>使用 MRI 脚本，首先写一个 MRI 脚本， <code>merge.mri</code> ，写入如下内容</p>
<pre tabindex="0"><code>create libmerge.a
addlib liba.a 
addlib libb.a
save
end
</code></pre><p>然后使用命令</p>
<pre tabindex="0"><code>ar -M &lt; merge.mri
</code></pre></li>
<li>
<p>方法</p>
<p>使用 <code>libtool</code> 命令</p>
<pre tabindex="0"><code>libtool -static -o libmerge.a liba.a libb.a
</code></pre></li>
</ol>
<p>上述方法中，方法1，4适用于macos，方法1，2，3均适用于linux</p>
<h2 id="生成器表达式">生成器表达式</h2>
<p>就是再 <code>cmake</code> 生成构建系统时根据不同配置动态生成特定的内容，着就依赖于不同的条件。生成器表达式的格式为 <code>$&lt;...&gt;</code> ，可以嵌套，可以在很多构建目标的属性设置和特定的 <code>cmake</code> 指令中，并且在生成构建系统时表达式被展开，所以不能通过解析配置 <code>CMakeLists.txt</code> 阶段的 <code>message</code> 指令打印</p>
<h3 id="布尔生成器表达式">布尔生成器表达式</h3>
<p><strong class=chinese>逻辑运算符</strong></p>
<ol>
<li><code>$&lt;BOOL:string&gt;</code> 如果字符串为空，0。不区分大小写的 <code>FALSE</code> ， <code>OFF</code> ， <code>N</code> ， <code>NO</code> ， <code>IGNORE</code> ， <code>NOTFOUND</code> 。或者区分大小写以 <code>-NOTFOUND</code> 结尾的字符串，则为 0，否则为 1</li>
<li><code>$&lt;AND:condition&gt;</code> 逻辑与， <code>condition</code> 是以逗号分割的条件列表</li>
<li><code>$&lt;OR:condition&gt;</code> 逻辑或</li>
<li><code>$&lt;NOT:condition&gt;</code> 逻辑非</li>
</ol>
<p><strong class=chinese>字符串比较</strong></p>
<ol>
<li><code>$&lt;STREQUAL:str1, str2&gt;</code> 判断字符串是否相等</li>
<li><code>$&lt;EQUAL:val1, val2&gt;</code> 判断数值是否相等</li>
<li><code>$&lt;IN_LIST:str, list&gt;</code> 判断字符串是否在列表 <code>list</code> 中</li>
</ol>
<p><strong class=chinese>变量查询</strong></p>
<ol>
<li><code>$&lt;TARGET_EXISTS:target&gt;</code> 判断目标是否存在</li>
<li><code>$&lt;CONFIG:cfg&gt;</code> 判断编译类型配置是否包含在 <code>cfg</code> 列表中，不区分大小写</li>
<li><code>$&lt;PLATFORM_ID:platform_ids&gt;</code> 判断cmake定义的平台ID是否包含在 <code>platform_ids</code> 列表中</li>
<li><code>$&lt;COMPILE_LANGUAGE:languages&gt;</code> 判断编译语言是否包含在 <code>languages</code> 列表中</li>
</ol>
<h3 id="字符串值生成器表达式">字符串值生成器表达式</h3>
<p>使用生成表达式的目的是生成特殊的字符串</p>
<p><strong class=chinese>条件表达式</strong></p>
<p>主要是两种格式</p>
<ol>
<li><code>$&lt;condition:true_string&gt;</code> 如果条件为真，则结果为 <code>true_string</code> ，否则为空</li>
<li><code>$&lt;IF:condition,str1,str2&gt;</code> 如果条件为真，结果为 <code>str1</code> ，否则 <code>str2</code></li>
</ol>
<p><strong class=chinese>转义字符</strong></p>
<p>由于有些字符有特殊含义，可能需要转义，例如</p>
<ul>
<li><code>$&lt;COMMA&gt;</code> 表示 <code>,</code></li>
<li><code>$&lt;SEMICOLON&gt;</code> 表示 <code>;</code></li>
</ul>
<p><strong class=chinese>字符串操作</strong></p>
<ul>
<li><code>$&lt;LOWER_CASE:string&gt;</code> 将字符串转为小写</li>
<li><code>$&lt;UPPER_CASE:string&gt;</code> 将字符串转为大写</li>
</ul>
<p><strong class=chinese>获取变量值</strong></p>
<p>与上文中的变量查询很类似</p>
<ol>
<li><code>$&lt;CONFIG&gt;</code> 获取变量值</li>
<li><code>$&lt;CONFIG:cfgs&gt;</code> 判断是否存在于列表中</li>
</ol>
<p><strong class=chinese>编译目标信息</strong></p>
<p>更多信息：<a href="https://cmake.org/cmake/help/latest/manual/cmake-generator-expressions.7.html#target-dependent-queries">target-dependent-queries</a></p>
<p>编译目标：是指通过 <code>add_execuate()</code> 和 <code>add_library()</code> 指令生成的目标文件和库文件</p>
<ol>
<li><code>$&lt;TARGET_FILE:tgt&gt;</code> 获取编译目标 <code>tgt</code> 的文件路径</li>
<li><code>$&lt;TARGET_FILE_NAME:tgt&gt;</code> 获取编译目标的文件名</li>
<li><code>$&lt;TARGET_FILE_BASE_NAME:tgt&gt;</code> 获取编译目标的基础名字，也就是文件名去除前缀和扩展名</li>
</ol>
<h3 id="调试信息">调试信息</h3>
<ol>
<li>
<p>通过输出到文件的方式，在 <code>cmake</code> 执行完之后检查是否符合预期</p>
<pre tabindex="0"><code>file(GENERATE OUTPUT &#34;./ouput.txt&#34; CONTENT &#34;$&lt;$&lt;CONFIG:Debug&gt;:-g;-O0&gt;,$&lt;PLATFORM_ID&gt;\n&#34;)
</code></pre><p>执行完 <code>cmake</code> 之后在文件中得到生成器表达式的内容</p>
</li>
<li>
<p>添加一个自定义目标</p>
<pre tabindex="0"><code>add_custom_target(gentest COMMAND ${CMAKE_COMMAND} -E echo &#34;\&#34;$&lt;$&lt;CONFIG:Debug&gt;:-g;-O0&gt;,$&lt;PLATFORM_ID&gt;\&#34;&#34;)
</code></pre><p>这里需要将双引号转义，以便确保生成器表达式展开之后为字符串</p>
<p>在执行 <code>cmake</code> 之后，可以使用 <code>make gentest</code> 命令输出到生成器表达式的内容</p>
</li>
</ol>

    
  </article>
  

<div id="sharingbuttons">
    
    
    <a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fseashore.top%2fBlog_Hugo%2fpost%2f2024%2f04%2f02%2fcmakelists%25E7%25BC%2596%25E5%2586%2599%2f" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=CMakeLists%e7%bc%96%e5%86%99&amp;url=https%3a%2f%2fseashore.top%2fBlog_Hugo%2fpost%2f2024%2f04%2f02%2fcmakelists%25E7%25BC%2596%25E5%2586%2599%2f" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="mailto:?subject=CMakeLists%e7%bc%96%e5%86%99&amp;body=https%3a%2f%2fseashore.top%2fBlog_Hugo%2fpost%2f2024%2f04%2f02%2fcmakelists%25E7%25BC%2596%25E5%2586%2599%2f" target="_self" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9 0 6v12c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17 0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1 0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08 0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2fseashore.top%2fBlog_Hugo%2fpost%2f2024%2f04%2f02%2fcmakelists%25E7%25BC%2596%25E5%2586%2599%2f" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6 0 2.5 1 2.6 2.5 0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3a%2f%2fseashore.top%2fBlog_Hugo%2fpost%2f2024%2f04%2f02%2fcmakelists%25E7%25BC%2596%25E5%2586%2599%2f&amp;resubmit=true&amp;title=CMakeLists%e7%bc%96%e5%86%99" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96 0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65 0 3-1.35 3-3s-1.35-3-3-3c-1.38 0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65 0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66 0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64 0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4 0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6 0 .23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1 0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="whatsapp://send?text=https%3a%2f%2fseashore.top%2fBlog_Hugo%2fpost%2f2024%2f04%2f02%2fcmakelists%25E7%25BC%2596%25E5%2586%2599%2f" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.1 3.9C17.9 1.7 15 .5 12 .5 5.8.5.7 5.6.7 11.9c0 2 .5 3.9 1.5 5.6L.6 23.4l6-1.6c1.6.9 3.5 1.3 5.4 1.3 6.3 0 11.4-5.1 11.4-11.4-.1-2.8-1.2-5.7-3.3-7.8zM12 21.4c-1.7 0-3.3-.5-4.8-1.3l-.4-.2-3.5 1 1-3.4L4 17c-1-1.5-1.4-3.2-1.4-5.1 0-5.2 4.2-9.4 9.4-9.4 2.5 0 4.9 1 6.7 2.8 1.8 1.8 2.8 4.2 2.8 6.7-.1 5.2-4.3 9.4-9.5 9.4zm5.1-7.1c-.3-.1-1.7-.9-1.9-1-.3-.1-.5-.1-.7.1-.2.3-.8 1-.9 1.1-.2.2-.3.2-.6.1s-1.2-.5-2.3-1.4c-.9-.8-1.4-1.7-1.6-2-.2-.3 0-.5.1-.6s.3-.3.4-.5c.2-.1.3-.3.4-.5.1-.2 0-.4 0-.5C10 9 9.3 7.6 9 7c-.1-.4-.4-.3-.5-.3h-.6s-.4.1-.7.3c-.3.3-1 1-1 2.4s1 2.8 1.1 3c.1.2 2 3.1 4.9 4.3.7.3 1.2.5 1.6.6.7.2 1.3.2 1.8.1.6-.1 1.7-.7 1.9-1.3.2-.7.2-1.2.2-1.3-.1-.3-.3-.4-.6-.5z"/></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fseashore.top%2fBlog_Hugo%2fpost%2f2024%2f04%2f02%2fcmakelists%25E7%25BC%2596%25E5%2586%2599%2f&amp;t=CMakeLists%e7%bc%96%e5%86%99" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    	<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 140 140"><path fill-rule="evenodd" d="M60.94 82.314L17 0h20.08l25.85 52.093c.397.927.86 1.888 1.39 2.883.53.994.995 2.02 1.393 3.08.265.4.463.764.596 1.095.13.334.262.63.395.898.662 1.325 1.26 2.618 1.79 3.877.53 1.26.993 2.42 1.39 3.48 1.06-2.254 2.22-4.673 3.48-7.258 1.26-2.585 2.552-5.27 3.877-8.052L103.49 0h18.69L77.84 83.308v53.087h-16.9v-54.08z"></path></svg>
        </div>
      </div>
    </a>
    

    
    
    <a class="resp-sharing-button__link" href="https://telegram.me/share/url?text=CMakeLists%e7%bc%96%e5%86%99&amp;url=https%3a%2f%2fseashore.top%2fBlog_Hugo%2fpost%2f2024%2f04%2f02%2fcmakelists%25E7%25BC%2596%25E5%2586%2599%2f" target="_blank" rel="noopener" aria-label="">
      <div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M.707 8.475C.275 8.64 0 9.508 0 9.508s.284.867.718 1.03l5.09 1.897 1.986 6.38a1.102 1.102 0 0 0 1.75.527l2.96-2.41a.405.405 0 0 1 .494-.013l5.34 3.87a1.1 1.1 0 0 0 1.046.135 1.1 1.1 0 0 0 .682-.803l3.91-18.795A1.102 1.102 0 0 0 22.5.075L.706 8.475z"/></svg>
        </div>
      </div>
    </a>
    
</div>

  <div class="paginator">
    
    <a class="link" href="https://seashore.top/Blog_Hugo/post/2024/04/02/makefile%E7%BC%96%E5%86%99/">← prev</a>
    
    
    <a class="link" href="https://seashore.top/Blog_Hugo/post/2024/04/02/gtest%E4%BD%BF%E7%94%A8/">next →</a>
    
  </div>
  <div class="comment">
    
    
    
    <script src="https://giscus.app/client.js"
        data-repo="weastur/hugo-texify2"
        data-repo-id="R_kgDOJwiYnA"
        data-category="Comments"
        data-category-id="DIC_kwDOJwiYnM4CXVgQ"
        data-mapping="title"
        data-strict="1"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>

  </div>
  

</main>

    <footer id="footer">
  <div>
    <span>© 2024</span> - <span>2024</span>
  </div>
  <div>
    <span><img src="https://gcore.jsdelivr.net/gh/CNhuazhu/TuChuang4/blog/备案图标.png">
<a href="https://beian.miit.gov.cn/" target="_blank">豫ICP备2024056598号-1</a>
</span>
  </div>

  <div>
    <span>Powered by </span>
    <a class="link" target="_blank" href="https://gohugo.io/">Hugo</a>
    <span> 🍦 Theme </span>
    <a class="link" target="_blank" href="https://texify2.io">TeXify2</a>
  </div>

  <div class="footnote">
    <span>Follow me on <a class=link href=https://github.com/Luo25177 target=_blank rel=noopener>GitHub</a> |
<a class=link href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en target=_blank rel=noopener>CC BY-NC-SA 4.0</a>
</span>
  </div>
</footer>

  </div>

  
  

  
  

  
  
  



</body>

</html>
